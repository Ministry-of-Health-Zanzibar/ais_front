<div class="p-10 space-y-8" *ngIf="permission.parmissionMatched(['View Report'])">
  <div class="flex items-center justify-between">
    <h1 class="text-lg font-bold">View Report</h1>
    <!-- Export Buttons -->
    <div class="flex gap-4">
      <button mat-raised-button color="accent" (click)="exportExcel()">
        <mat-icon>table_chart</mat-icon>
        Export Excel
      </button>
      <button mat-raised-button color="warn" (click)="exportPDF()">
        <mat-icon>picture_as_pdf</mat-icon>
        Export PDF
      </button>
    </div>
  </div>

 <div class="search-container bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
  <form [formGroup]="reportForm" class="space-y-6">

    <!-- Section Title -->
    <h2 class="text-xl font-bold text-gray-800 mb-2">Filter Reports</h2>

    <!-- Grid for Form Fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Search By Source Name -->
      <div>
        <label class="block mb-1 text-sm font-medium text-gray-700">Source Name</label>
        <mat-form-field appearance="fill" class="w-full">
           <mat-select formControlName="source_name" >
         <mat-option *ngFor="let s of sources" (click)="onGetSourceTypeName(s.source_name)" [value]="s.source_id">
             {{ s.source_name }}
        </mat-option>
       </mat-select>
        </mat-form-field>
      </div>

      <div>
        <label class="block mb-1 text-sm font-medium text-gray-700">Source Type</label>
        <mat-form-field appearance="fill" class="w-full">
           <mat-select formControlName="source_type_name">
        <mat-option *ngFor="let type of sourceTypes" [value]="type.source_type_id">
          {{ type.source_type_name }}
          </mat-option>
        </mat-select>
        </mat-form-field>
      </div>

      <!-- Start Date -->
      <div>
        <label class="block mb-1 text-sm font-medium text-gray-700">Start Date</label>
        <input
          type="date"
          formControlName="start_date"
          class="w-full rounded-lg border border-gray-300 p-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- End Date -->
      <div>
        <label class="block mb-1 text-sm font-medium text-gray-700">End Date</label>
        <input
          type="date"
          formControlName="end_date"
          class="w-full rounded-lg border border-gray-300 p-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
    </div>

    <!-- Search Button -->
    <div class="flex justify-end">
      <button
        mat-flat-button
        color="primary"
        class="px-6 py-3 rounded-lg text-white bg-blue-600 hover:bg-blue-700 flex items-center gap-2"
        (click)="fetchReports()"
      >
        <mat-icon>search</mat-icon>
        Search
      </button>
    </div>

  </form>
</div>



  <div class="mt-4 flex items-center justify-between">
    <div class="flex items-center gap-1.5">
      <div class="size-9 rounded-full border bg-surface flex items-center justify-center" (click)="renew()" matTooltip="Refresh">
        <mat-icon class="font-icon visibilityData">refresh</mat-icon>
      </div>
      <input type="text" placeholder="Search..." class="border-b h-10 w-96 text-sm bg-transparent dark:border-b-inverse outline-0 focus-within:border-neutral-950" matInput (keyup)="applyFilter($event)" #input>
    </div>
  </div>

  <div class="border dark:border-inverse rounded-lg overflow-hidden mt-4">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
      <!-- No Column -->
      <ng-container matColumnDef="no">
        <th mat-header-cell *matHeaderCellDef>No</th>
        <td mat-cell *matCellDef="let element; let i = index">{{ i + 1 }}</td>
      </ng-container>

      <!-- Full Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Full Name</th>
        <td mat-cell *matCellDef="let element">{{ element.payee_name | uppercase}}</td>
      </ng-container>
      <!-- <ng-container matColumnDef="fullname">
        <th mat-header-cell *matHeaderCellDef>Full Name</th>
        <td mat-cell *matCellDef="let element">{{ element.first_name + ' ' + element.middle_name+ ' '+ element.last_name}}</td>
      </ng-container> -->

      <!-- Phone Column -->
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Ammount</th>
        <td mat-cell *matCellDef="let element">{{ element.amount }}</td>
      </ng-container>

      <ng-container matColumnDef="tin_number">
        <th mat-header-cell *matHeaderCellDef>Tin Number</th>
        <td mat-cell *matCellDef="let element">{{ element.tin_number }}</td>
      </ng-container>

      <ng-container matColumnDef="source_name">
        <th mat-header-cell *matHeaderCellDef>Source Name</th>
        <td mat-cell *matCellDef="let element">{{ element.source_name }}</td>
      </ng-container>

      <ng-container matColumnDef="source_type_name">
        <th mat-header-cell *matHeaderCellDef>Source Type</th>
        <td mat-cell *matCellDef="let element">{{ element.source_type_name }}</td>
      </ng-container>

      <ng-container matColumnDef="category_name">
        <th mat-header-cell *matHeaderCellDef>Category Name</th>
        <td mat-cell *matCellDef="let element">{{ element.category_name }}</td>
      </ng-container>

      <ng-container matColumnDef="document_type_name">
        <th mat-header-cell *matHeaderCellDef>Document Type</th>
        <td mat-cell *matCellDef="let element">{{ element.document_type_name }}</td>
      </ng-container>

      <ng-container matColumnDef="pdf_file">
        <th mat-header-cell *matHeaderCellDef>View PDF</th>
        <td mat-cell *matCellDef="let element"> <ng-container *ngIf="element.document_file && element.document_file.endsWith('.pdf');">
          <a
                *ngIf="element?.document_file"
                (click)="viewPDF(element)"
                class="inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-800 cursor-pointer"
              >
                <mat-icon>picture_as_pdf</mat-icon> View PDF
              </a>
        </ng-container></td>
      </ng-container>


      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell tablefoter" colspan="10">No data matching the filter "{{input.value}}"</td>
      </tr>
    </table>
    <mat-paginator [pageSizeOptions]="[10, 20, 100]" showFirstLastButtons></mat-paginator>
  </div>
</div>


